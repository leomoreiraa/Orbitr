<ng-container *ngIf="auth.isAuthenticated() && isBoardRoute(); else publicLayout">
  <div class="flex min-h-screen overflow-y-auto">
    <!-- Desktop sidebar (hidden on small screens) -->
    <aside class="sidebar hidden md:flex">
      <!-- Logo Orbitr -->
      <div class="flex items-center gap-2 mb-6 pb-4 border-b border-[var(--border)]">
        <img src="icon.png" alt="Orbitr" width="32" height="32">
        <span class="font-bold text-lg bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Orbitr</span>
      </div>
      
  <div class="text-lg font-semibold mb-4">Olá, {{ auth.getFriendlyName() || 'usuário' }}</div>
      <div class="text-xs font-semibold tracking-wider text-[var(--text-soft)] uppercase mb-1">Filtros</div>
      <ul class="flex flex-col gap-1 mb-4">
        <li (click)="filters.setStatus('ALL')" class="sidebar-item" [class.sidebar-item-active]="filters.status()==='ALL'">▤ Todas</li>
        <li (click)="filters.setStatus('PENDING')" class="sidebar-item" [class.sidebar-item-active]="filters.status()==='PENDING'">⏱ Pendentes</li>
        <li (click)="filters.setStatus('DONE')" class="sidebar-item" [class.sidebar-item-active]="filters.status()==='DONE'">✔ Concluídas</li>
      </ul>
      <!-- Boards Próprias -->
      <div class="text-xs font-semibold tracking-wider text-[var(--text-soft)] uppercase mb-1">Meus Boards</div>
      <ul class="flex flex-col gap-1 mb-4">
        <li *ngFor="let b of boardsState.ownBoards()" (click)="boardsState.select(b.id)" class="sidebar-item relative group"
            [class.sidebar-item-active]="boardsState.currentBoardId()===b.id">
          <span class="flex-1 truncate">{{ b.icon ? b.icon + ' ' : ''}}{{ b.nome }}</span>
          <button class="board-menu-trigger w-6 h-6 rounded-md border border-[var(--border)] text-xs opacity-0 group-hover:opacity-100 transition"
                  (click)="toggleBoardMenu($event, b.id)" aria-label="Menu do board">⋯</button>
          <div *ngIf="boardMenuOpenId()===b.id" class="absolute top-8 right-0 z-20 min-w-[140px] bg-[var(--bg)] border border-[var(--border)] rounded-lg shadow-lg p-1 flex flex-col text-xs">
            <button (click)="renameBoard($event, b)" class="text-left px-3 py-2 rounded-md hover:bg-[var(--bg-soft)]">Renomear</button>
            <button (click)="deleteBoard($event, b)" class="text-left px-3 py-2 rounded-md hover:bg-red-50 text-red-600">Excluir</button>
            <button (click)="openCreateBoardDialog()" class="text-left px-3 py-2 rounded-md hover:bg-[var(--bg-soft)]">Novo Board</button>
          </div>
        </li>
      </ul>

      <!-- Boards Compartilhadas -->
      <div *ngIf="boardsState.sharedBoards().length > 0">
        <div class="border-t border-[var(--border)] pt-3 mb-3"></div>
        <div class="text-xs font-semibold tracking-wider text-[var(--text-soft)] uppercase mb-1">
          👥 Compartilhados
        </div>
        <ul class="flex flex-col gap-1 mb-4">
          <li *ngFor="let b of boardsState.sharedBoards()" (click)="boardsState.select(b.id)" class="sidebar-item relative group"
              [class.sidebar-item-active]="boardsState.currentBoardId()===b.id">
            <span class="flex-1 truncate opacity-80">{{ b.icon ? b.icon + ' ' : '📋 '}}{{ b.nome }}</span>
            <span class="text-xs text-[var(--text-soft)] opacity-60">👥</span>
          </li>
        </ul>
      </div>
      
      <!-- Botão para criar novo board movido para o final -->
      <div class="mt-auto mb-4">
        <button (click)="openCreateBoardDialog()" class="w-full flex items-center gap-2 px-3 py-2 text-sm font-medium text-[var(--text-soft)] hover:text-[var(--text)] hover:bg-[var(--bg-soft)] rounded-lg border-2 border-dashed border-[var(--border)] hover:border-blue-400 transition-colors">
          <span class="text-lg">＋</span>
          <span>Criar Novo Board</span>
        </button>
      </div>
      
      <div class="flex gap-2">
        <button (click)="theme.toggle()" class="w-9 h-9 rounded-full border border-[var(--border)]">{{ theme.mode()==='dark' ? '☀️' : '🌙' }}</button>
        <button (click)="logout($event)" class="w-9 h-9 rounded-full border border-[var(--border)]">⎋</button>
      </div>
    </aside>

    <!-- Mobile off-canvas sidebar -->
    <aside class="sidebar fixed inset-y-0 left-0 z-50 w-64 transform transition-transform duration-300 md:hidden"
           [ngClass]="{ '-translate-x-full': !sidebarOpen(), 'translate-x-0': sidebarOpen() }"
           role="dialog" aria-modal="true" *ngIf="auth.isAuthenticated() && isBoardRoute()">
      <div class="flex items-center gap-2 mb-6 pb-4 border-b border-[var(--border)] p-4">
        <img src="icon.png" alt="Orbitr" width="32" height="32">
        <span class="font-bold text-lg bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Orbitr</span>
      </div>
      <div class="p-4 overflow-y-auto h-full">
        <div class="text-lg font-semibold mb-4">Olá, {{ auth.getFriendlyName() || 'usuário' }}</div>
        <div class="text-xs font-semibold tracking-wider text-[var(--text-soft)] uppercase mb-1">Filtros</div>
        <ul class="flex flex-col gap-1 mb-4">
          <li (click)="filters.setStatus('ALL'); toggleSidebar()" class="sidebar-item" [class.sidebar-item-active]="filters.status()==='ALL'">▤ Todas</li>
          <li (click)="filters.setStatus('PENDING'); toggleSidebar()" class="sidebar-item" [class.sidebar-item-active]="filters.status()==='PENDING'">⏱ Pendentes</li>
          <li (click)="filters.setStatus('DONE'); toggleSidebar()" class="sidebar-item" [class.sidebar-item-active]="filters.status()==='DONE'">✔ Concluídas</li>
        </ul>
        <div class="text-xs font-semibold tracking-wider text-[var(--text-soft)] uppercase mb-1">Meus Boards</div>
        <ul class="flex flex-col gap-1 mb-4">
          <li *ngFor="let b of boardsState.ownBoards()" (click)="boardsState.select(b.id); toggleSidebar()" class="sidebar-item relative group"
              [class.sidebar-item-active]="boardsState.currentBoardId()===b.id">
            <span class="flex-1 truncate">{{ b.icon ? b.icon + ' ' : ''}}{{ b.nome }}</span>
          </li>
        </ul>
        <div class="mt-auto mb-4">
          <button (click)="openCreateBoardDialog(); toggleSidebar()" class="w-full flex items-center gap-2 px-3 py-2 text-sm font-medium text-[var(--text-soft)] hover:text-[var(--text)] hover:bg-[var(--bg-soft)] rounded-lg border-2 border-dashed border-[var(--border)] hover:border-blue-400 transition-colors">
            <span class="text-lg">＋</span>
            <span>Criar Novo Board</span>
          </button>
        </div>
        <div class="flex gap-2">
          <button (click)="theme.toggle()" class="w-9 h-9 rounded-full border border-[var(--border)]">{{ theme.mode()==='dark' ? '☀️' : '🌙' }}</button>
          <button (click)="logout($event)" class="w-9 h-9 rounded-full border border-[var(--border)]">⎋</button>
        </div>
      </div>
    </aside>

    <!-- Mobile overlay when sidebar is open -->
    <div *ngIf="sidebarOpen()" class="fixed inset-0 bg-black/40 z-40 md:hidden" (click)="toggleSidebar()" aria-hidden="true"></div>
    <div class="flex-1 flex flex-col min-w-0">
      <header class="h-14 flex items-center justify-between px-6 border-b border-[var(--border)] bg-[var(--bg-soft)]/60 backdrop-blur">
        <div class="flex items-center gap-3 text-sm">
          <button class="w-9 h-9 rounded-full border border-[var(--border)] md:hidden" (click)="toggleSidebar()">☰</button>
          <span class="font-medium">{{ currentBoardName() }}</span>
          <span class="text-[var(--text-soft)] hidden sm:inline">{{ auth.getFriendlyName() || 'usuário' }}</span>
        </div>
        <div class="flex items-center gap-2">
          <button *ngIf="currentBoardId()" 
                  (click)="openShareDialog()" 
                  class="btn btn-sm bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
            <span class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
              </svg>
              Compartilhar
            </span>
          </button>
          <button (click)="triggerAddColumn()" class="btn btn-sm">＋ Lista</button>
        </div>
      </header>
      <div class="flex-1 p-6 overflow-x-auto overflow-y-auto">
        <router-outlet></router-outlet>
      </div>
    </div>
  </div>
  <!-- Mobile bottom quick actions -->
  <div class="mobile-bottom-nav md:hidden">
    <button class="btn btn-sm btn-ghost" (click)="toggleSidebar()">☰</button>
    <button class="btn btn-sm" (click)="triggerAddColumn()">＋ Lista</button>
    <button class="btn btn-sm btn-ghost" (click)="openShareDialog()">Compartilhar</button>
  </div>
</ng-container>
<ng-template #publicLayout>
  <router-outlet></router-outlet>
</ng-template>
